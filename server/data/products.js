/**
 * VelocityVault Product Database
 *
 * Structured product data served through x402-gated API endpoints.
 * All Amazon ASINs are real, verified, in-stock products.
 */

const AMAZON_TAG = 'bicycles0b3-20';

const products = [
  // ===== 16" BMX (Kids 3-7) =====
  {
    id: '1',
    name: 'Mongoose Skid 16" Boys BMX',
    category: 'bmx-16',
    subcategory: 'kids',
    wheelSize: '16"',
    price: 89.99,
    msrp: 109.99,
    asin: 'B0183SEV3W',
    brand: 'Mongoose',
    style: 'SE Lil Ripper',
    rating: 4.3,
    reviews: 1247,
    description: 'Entry level kids BMX with training wheel mounts, steel frame, coaster brake.',
    specs: { frame: 'Steel', brakes: 'Coaster', tires: '16x2.125', weight: '22 lbs', gearing: 'Single Speed' },
    tags: ['kids', 'beginner', 'entry-level', 'training-wheels'],
    inStock: true,
  },
  {
    id: '2',
    name: 'Dynacraft Sunset 16" Girls BMX',
    category: 'bmx-16',
    subcategory: 'kids',
    wheelSize: '16"',
    price: 79.99,
    msrp: 99.99,
    asin: 'B0DY1XWFVQ',
    brand: 'Dynacraft',
    style: 'SE Lil Flyer',
    rating: 4.1,
    reviews: 834,
    description: 'Girls style BMX with fun colorway, steel frame, front handbrake.',
    specs: { frame: 'Steel', brakes: 'Front Hand + Coaster', tires: '16x2.0', weight: '21 lbs', gearing: 'Single Speed' },
    tags: ['kids', 'girls', 'beginner', 'colorful'],
    inStock: true,
  },

  // ===== 18" BMX (Kids 5-7) =====
  {
    id: '3',
    name: 'Mongoose Switch 18" BMX',
    category: 'bmx-18',
    subcategory: 'kids',
    wheelSize: '18"',
    price: 109.99,
    msrp: 129.99,
    asin: 'B0CYMBBFK8',
    brand: 'Mongoose',
    style: 'SE Bronco',
    rating: 4.4,
    reviews: 967,
    description: 'Mag wheel 18" BMX with detangler for barspins, front and rear pegs.',
    specs: { frame: 'Steel', brakes: 'Front & Rear Hand', tires: '18x2.125', weight: '25 lbs', gearing: 'Single Speed', extras: 'Mag Wheels, Pegs' },
    tags: ['kids', 'mag-wheels', 'pegs', 'intermediate'],
    inStock: true,
  },

  // ===== 20" Freestyle BMX =====
  {
    id: '4',
    name: 'WEIZE Freestyle BMX 20"',
    category: 'bmx-20',
    subcategory: 'freestyle',
    wheelSize: '20"',
    price: 159.99,
    msrp: 199.99,
    asin: 'B0F9WZ75SB',
    brand: 'WEIZE',
    style: 'SE Wildman',
    rating: 4.5,
    reviews: 2134,
    description: 'Top-rated freestyle BMX. Hi-ten steel frame, 4 pegs, detangler, 3-piece crank.',
    specs: { frame: 'Hi-Ten Steel', brakes: 'U-Brake Front & Rear', tires: '20x2.3', weight: '28 lbs', gearing: '25/9T', extras: '4 Pegs, Detangler, 3pc Crank' },
    tags: ['freestyle', 'pegs', 'street', 'park', 'best-seller'],
    inStock: true,
  },
  {
    id: '5',
    name: 'Hiland 20" Freestyle BMX',
    category: 'bmx-20',
    subcategory: 'freestyle',
    wheelSize: '20"',
    price: 149.99,
    msrp: 189.99,
    asin: 'B0BWQ8X8FZ',
    brand: 'Hiland',
    style: 'SE Everyday',
    rating: 4.4,
    reviews: 1876,
    description: 'Street-ready freestyle BMX with 4 pegs, top-load stem, sealed bearings.',
    specs: { frame: 'Hi-Ten Steel', brakes: 'U-Brake Rear', tires: '20x2.3', weight: '27 lbs', gearing: '25/9T', extras: '4 Pegs, Top-Load Stem' },
    tags: ['freestyle', 'street', 'pegs', 'sealed-bearings'],
    inStock: true,
  },
  {
    id: '6',
    name: 'RoyalBaby 20" BMX Freestyle',
    category: 'bmx-20',
    subcategory: 'freestyle',
    wheelSize: '20"',
    price: 139.99,
    msrp: 169.99,
    asin: 'B0GCMRHHXH',
    brand: 'RoyalBaby',
    style: 'SE Street',
    rating: 4.3,
    reviews: 1543,
    description: 'Street style BMX with dual hand brakes, kickstand, bell. Great for beginners.',
    specs: { frame: 'Steel', brakes: 'Dual Hand', tires: '20x2.125', weight: '26 lbs', gearing: 'Single Speed' },
    tags: ['freestyle', 'street', 'beginner', 'dual-brake'],
    inStock: true,
  },
  {
    id: '7',
    name: 'Elite BMX Freestyle 20"',
    category: 'bmx-20',
    subcategory: 'freestyle',
    wheelSize: '20"',
    price: 219.99,
    msrp: 269.99,
    asin: 'B0C95Q1W12',
    brand: 'Elite',
    style: 'SE Pro',
    rating: 4.6,
    reviews: 987,
    description: 'Pro-grade freestyle. Chromoly bars, sealed hubs, double-wall rims, 4 pegs.',
    specs: { frame: 'Hi-Ten Steel', bars: 'Chromoly', brakes: 'U-Brake', tires: '20x2.4', weight: '26 lbs', gearing: '25/9T', extras: '4 Pegs, Sealed Hubs, Double-Wall Rims' },
    tags: ['pro', 'freestyle', 'chromoly', 'sealed-hubs'],
    inStock: true,
  },
  {
    id: '8',
    name: 'JOYSTAR 20" Freestyle BMX',
    category: 'bmx-20',
    subcategory: 'freestyle',
    wheelSize: '20"',
    price: 129.99,
    msrp: 159.99,
    asin: 'B0CNK4RSP3',
    brand: 'JOYSTAR',
    style: 'SE Youth',
    rating: 4.2,
    reviews: 1234,
    description: 'Youth freestyle BMX with dual pegs, detangler, and alloy wheels.',
    specs: { frame: 'Steel', brakes: 'U-Brake', tires: '20x2.125', weight: '27 lbs', gearing: 'Single Speed', extras: 'Dual Pegs, Detangler' },
    tags: ['youth', 'freestyle', 'pegs', 'budget'],
    inStock: true,
  },
  {
    id: '9',
    name: 'Elite BMX Stealth 20"',
    category: 'bmx-20',
    subcategory: 'freestyle',
    wheelSize: '20"',
    price: 199.99,
    msrp: 249.99,
    asin: 'B09239HYM8',
    brand: 'Elite',
    style: 'SE Stealth',
    rating: 4.5,
    reviews: 876,
    description: 'Murdered-out stealth edition. All black with sealed mid BB, double-wall rims.',
    specs: { frame: 'Hi-Ten Steel', brakes: 'U-Brake', tires: '20x2.4', weight: '27 lbs', gearing: '25/9T', extras: 'Sealed Mid BB, Double-Wall Rims' },
    tags: ['freestyle', 'stealth', 'all-black', 'sealed-bb'],
    inStock: true,
  },
  {
    id: '10',
    name: 'vollsch Freestyle 20" Multi-Color',
    category: 'bmx-20',
    subcategory: 'freestyle',
    wheelSize: '20"',
    price: 134.99,
    msrp: 164.99,
    asin: 'B0FH5TCJMV',
    brand: 'vollsch',
    style: 'SE Custom',
    rating: 4.1,
    reviews: 654,
    description: 'Multi-color freestyle BMX with eye-catching design, pegs, and gyro.',
    specs: { frame: 'Steel', brakes: 'U-Brake', tires: '20x2.125', weight: '28 lbs', gearing: 'Single Speed', extras: 'Pegs, Gyro' },
    tags: ['freestyle', 'colorful', 'gyro', 'pegs'],
    inStock: true,
  },
  {
    id: '11',
    name: 'cubsala Syzygy 20" Street',
    category: 'bmx-20',
    subcategory: 'street',
    wheelSize: '20"',
    price: 144.99,
    msrp: 179.99,
    asin: 'B0DKFDBRBJ',
    brand: 'cubsala',
    style: 'SE Street',
    rating: 4.2,
    reviews: 543,
    description: 'Street-focused BMX with responsive geometry, pegs, and rear U-brake.',
    specs: { frame: 'Steel', brakes: 'U-Brake Rear', tires: '20x2.25', weight: '27 lbs', gearing: '25/9T', extras: 'Pegs' },
    tags: ['street', 'responsive', 'pegs'],
    inStock: true,
  },
  {
    id: '12',
    name: 'Kent PRO 20" BMX',
    category: 'bmx-20',
    subcategory: 'freestyle',
    wheelSize: '20"',
    price: 119.99,
    msrp: 149.99,
    asin: 'B0D367N8BT',
    brand: 'Kent',
    style: 'SE Durable',
    rating: 4.0,
    reviews: 789,
    description: 'Durable frame BMX built for daily riding. Front and rear brakes, solid tires.',
    specs: { frame: 'Steel', brakes: 'Dual Hand', tires: '20x2.125', weight: '29 lbs', gearing: 'Single Speed' },
    tags: ['durable', 'daily', 'dual-brake', 'budget'],
    inStock: true,
  },
  {
    id: '13',
    name: 'Mongoose Legion L80 20"',
    category: 'bmx-20',
    subcategory: 'freestyle',
    wheelSize: '20"',
    price: 179.99,
    msrp: 219.99,
    asin: 'B0BBBN5D4W',
    brand: 'Mongoose',
    style: 'SE Advanced',
    rating: 4.5,
    reviews: 1456,
    description: 'Advanced freestyle. Hi-ten frame, 4 pegs, detangler, sealed mid BB.',
    specs: { frame: 'Hi-Ten Steel', brakes: 'U-Brake', tires: '20x2.3', weight: '27 lbs', gearing: '25/9T', extras: '4 Pegs, Sealed Mid BB, Detangler' },
    tags: ['advanced', 'freestyle', 'sealed-bb', 'pegs'],
    inStock: true,
  },
  {
    id: '14',
    name: 'Mongoose Legion L20 20"',
    category: 'bmx-20',
    subcategory: 'park',
    wheelSize: '20"',
    price: 169.99,
    msrp: 199.99,
    asin: 'B0BBQNCPTR',
    brand: 'Mongoose',
    style: 'SE Park/Street',
    rating: 4.4,
    reviews: 1123,
    description: 'Park and street ready. Tall bars, micro-drive gearing, gyro compatible.',
    specs: { frame: 'Hi-Ten Steel', brakes: 'U-Brake', tires: '20x2.3', weight: '26 lbs', gearing: '25/9T Micro', extras: 'Gyro Compatible' },
    tags: ['park', 'street', 'gyro', 'micro-drive'],
    inStock: true,
  },
  {
    id: '15',
    name: 'Mongoose Legion 20" Classic',
    category: 'bmx-20',
    subcategory: 'freestyle',
    wheelSize: '20"',
    price: 154.99,
    msrp: 189.99,
    asin: 'B07G1N7237',
    brand: 'Mongoose',
    style: 'SE Classic',
    rating: 4.3,
    reviews: 2345,
    description: 'Classic Mongoose Legion. Proven geometry, solid build, great value.',
    specs: { frame: 'Hi-Ten Steel', brakes: 'U-Brake', tires: '20x2.3', weight: '28 lbs', gearing: '25/9T' },
    tags: ['classic', 'freestyle', 'value', 'proven'],
    inStock: true,
  },
  {
    id: '16',
    name: 'Schwinn Koen 20" SmartStart',
    category: 'bmx-20',
    subcategory: 'kids',
    wheelSize: '20"',
    price: 124.99,
    msrp: 149.99,
    asin: 'B0CXT5G5CN',
    brand: 'Schwinn',
    style: 'SE SmartStart',
    rating: 4.2,
    reviews: 1087,
    description: 'SmartStart design with narrower grips, lower seat, and shorter reach for kids.',
    specs: { frame: 'Steel', brakes: 'Front & Rear Hand', tires: '20x2.0', weight: '25 lbs', gearing: 'Single Speed', extras: 'SmartStart Geometry' },
    tags: ['kids', 'smartstart', 'ergonomic'],
    inStock: true,
  },
  {
    id: '17',
    name: 'Schwinn Predator 20" Retro',
    category: 'bmx-20',
    subcategory: 'freestyle',
    wheelSize: '20"',
    price: 174.99,
    msrp: 209.99,
    asin: 'B08BCB2K9D',
    brand: 'Schwinn',
    style: 'SE Retro',
    rating: 4.4,
    reviews: 1567,
    description: 'Retro design Predator with classic colorway. Steel frame, front & rear pegs.',
    specs: { frame: 'Steel', brakes: 'U-Brake', tires: '20x2.125', weight: '28 lbs', gearing: 'Single Speed', extras: 'Front & Rear Pegs, Retro Design' },
    tags: ['retro', 'freestyle', 'classic', 'pegs'],
    inStock: true,
  },
  {
    id: '18',
    name: 'Schwinn Twister 20" Classic',
    category: 'bmx-20',
    subcategory: 'freestyle',
    wheelSize: '20"',
    price: 114.99,
    msrp: 139.99,
    asin: 'B07LC4W949',
    brand: 'Schwinn',
    style: 'SE Twister',
    rating: 4.1,
    reviews: 1890,
    description: 'Classic BMX styling with modern components. Great entry point for freestyle.',
    specs: { frame: 'Steel', brakes: 'Front & Rear Hand', tires: '20x2.125', weight: '26 lbs', gearing: 'Single Speed' },
    tags: ['classic', 'beginner', 'freestyle', 'budget'],
    inStock: true,
  },

  // ===== 24" BMX (Teen/Adult) =====
  {
    id: '19',
    name: 'Hiland 24" BMX Cruiser',
    category: 'bmx-24',
    subcategory: 'cruiser',
    wheelSize: '24"',
    price: 189.99,
    msrp: 229.99,
    asin: 'B09QM5DD95',
    brand: 'Hiland',
    style: 'SE Ripper 24',
    rating: 4.3,
    reviews: 876,
    description: 'Teen/adult BMX cruiser. Oversized 24" wheels, freestyle geometry, pegs.',
    specs: { frame: 'Hi-Ten Steel', brakes: 'U-Brake', tires: '24x2.3', weight: '30 lbs', gearing: '25/9T', extras: 'Pegs' },
    tags: ['cruiser', 'teen', 'adult', '24-inch', 'pegs'],
    inStock: true,
  },
  {
    id: '20',
    name: 'Schwinn SX1000 24" Retro Cruiser',
    category: 'bmx-24',
    subcategory: 'cruiser',
    wheelSize: '24"',
    price: 209.99,
    msrp: 259.99,
    asin: 'B07RB7GP4N',
    brand: 'Schwinn',
    style: 'SE Flyer 24',
    rating: 4.2,
    reviews: 654,
    description: 'Retro-styled 24" cruiser with fat tires, springer fork, and chopper handlebars.',
    specs: { frame: 'Steel', brakes: 'Rear Coaster + Front Hand', tires: '24x3.0 Fat', weight: '38 lbs', gearing: 'Single Speed', extras: 'Springer Fork, Chopper Bars' },
    tags: ['retro', 'cruiser', 'fat-tires', 'chopper'],
    inStock: true,
  },

  // ===== 26" Cruisers (SE Big Ripper style) =====
  {
    id: '21',
    name: 'R4 Pro 26" Cruiser Matte Grey',
    category: 'bmx-26',
    subcategory: 'cruiser',
    wheelSize: '26"',
    price: 349.99,
    msrp: 429.99,
    asin: 'B0CPC7X4LT',
    brand: 'R4',
    style: 'SE Big Ripper',
    rating: 4.6,
    reviews: 432,
    description: 'Big Ripper style 26" BMX cruiser. Chromoly frame, sealed bearings, 3-piece crank.',
    specs: { frame: 'Chromoly', brakes: 'Disc Front + U-Brake Rear', tires: '26x2.35', weight: '29 lbs', gearing: '39/16T', extras: 'Sealed Bearings, 3pc Crank' },
    tags: ['big-ripper', 'cruiser', 'chromoly', 'premium'],
    inStock: true,
  },
  {
    id: '22',
    name: 'R4 Pro 26" White/Purple',
    category: 'bmx-26',
    subcategory: 'cruiser',
    wheelSize: '26"',
    price: 359.99,
    msrp: 439.99,
    asin: 'B0FVBFXNFR',
    brand: 'R4',
    style: 'SE Big Ripper Retro',
    rating: 4.5,
    reviews: 378,
    description: 'Retro cruiser style with white/purple colorway. Same premium R4 build quality.',
    specs: { frame: 'Chromoly', brakes: 'Disc Front + U-Brake Rear', tires: '26x2.35', weight: '29 lbs', gearing: '39/16T', extras: 'Sealed Bearings, 3pc Crank' },
    tags: ['big-ripper', 'retro', 'cruiser', 'chromoly', 'colorway'],
    inStock: true,
  },
  {
    id: '23',
    name: 'Redline PL 26 BMX Cruiser',
    category: 'bmx-26',
    subcategory: 'cruiser',
    wheelSize: '26"',
    price: 399.99,
    msrp: 479.99,
    asin: 'B07BZK15V4',
    brand: 'Redline',
    style: 'SE Classic 26',
    rating: 4.4,
    reviews: 287,
    description: 'Legendary Redline 26" cruiser. Race heritage, chromoly frame, pro-level components.',
    specs: { frame: 'Chromoly', brakes: 'Linear Pull', tires: '26x2.0', weight: '27 lbs', gearing: '39/16T', extras: 'Sealed Hubs, Chromoly Fork' },
    tags: ['cruiser', 'race', 'chromoly', 'legendary', 'pro'],
    inStock: true,
  },

  // ===== 29" Adult Cruisers =====
  {
    id: '24',
    name: 'Gravity 29er Single Speed Cruiser',
    category: 'bmx-29',
    subcategory: 'cruiser',
    wheelSize: '29"',
    price: 299.99,
    msrp: 379.99,
    asin: 'B074WHRM5V',
    brand: 'Gravity',
    style: 'SE Big Ripper 29',
    rating: 4.3,
    reviews: 543,
    description: 'Massive 29" single speed cruiser. Big Ripper style with disc brakes and wide bars.',
    specs: { frame: 'Aluminum', brakes: 'Mechanical Disc', tires: '29x2.1', weight: '28 lbs', gearing: 'Single Speed', extras: 'Disc Brakes, Wide Bars' },
    tags: ['29er', 'cruiser', 'big-ripper', 'disc-brakes', 'adult'],
    inStock: true,
  },

  // ===== Electric Bikes =====
  {
    id: '25',
    name: 'TST Electric Dirt Bike 1500W',
    category: 'electric',
    subcategory: 'dirt',
    wheelSize: '19"/16"',
    price: 899.99,
    msrp: 1199.99,
    asin: 'B0DLXCJ123',
    brand: 'TST',
    style: 'SURRON Alternative',
    rating: 4.4,
    reviews: 345,
    description: '1500W electric dirt bike. SURRON-style performance at half the price. 60V battery, 35mph top speed.',
    specs: { motor: '1500W Brushless', battery: '60V 20Ah', topSpeed: '35 mph', range: '40 miles', weight: '110 lbs', brakes: 'Hydraulic Disc', suspension: 'Front & Rear', extras: 'LCD Display, Removable Battery' },
    tags: ['electric', 'dirt', 'surron', 'offroad', 'high-power'],
    inStock: true,
  },
];

/**
 * Computed market data from the product catalog
 */
function getMarketData() {
  const categories = {};
  let totalValue = 0;
  let totalProducts = products.length;

  for (const p of products) {
    if (!categories[p.category]) {
      categories[p.category] = { count: 0, avgPrice: 0, totalValue: 0, priceRange: { min: Infinity, max: 0 } };
    }
    const cat = categories[p.category];
    cat.count++;
    cat.totalValue += p.price;
    cat.priceRange.min = Math.min(cat.priceRange.min, p.price);
    cat.priceRange.max = Math.max(cat.priceRange.max, p.price);
    totalValue += p.price;
  }

  for (const key of Object.keys(categories)) {
    categories[key].avgPrice = +(categories[key].totalValue / categories[key].count).toFixed(2);
  }

  const brands = [...new Set(products.map(p => p.brand))];
  const topRated = [...products].sort((a, b) => b.rating - a.rating).slice(0, 5).map(p => ({ id: p.id, name: p.name, rating: p.rating, price: p.price }));
  const bestValue = [...products].sort((a, b) => (a.price / a.rating) - (b.price / b.rating)).slice(0, 5).map(p => ({ id: p.id, name: p.name, rating: p.rating, price: p.price, valueScore: +(p.rating / (p.price / 100)).toFixed(2) }));

  return {
    snapshot_date: new Date().toISOString(),
    total_products: totalProducts,
    total_catalog_value: +totalValue.toFixed(2),
    avg_price: +(totalValue / totalProducts).toFixed(2),
    brands,
    categories,
    top_rated: topRated,
    best_value: bestValue,
    price_range: { min: Math.min(...products.map(p => p.price)), max: Math.max(...products.map(p => p.price)) },
  };
}

function getAffiliateLink(asin) {
  return `https://www.amazon.com/dp/${asin}?tag=${AMAZON_TAG}`;
}

export { products, AMAZON_TAG, getMarketData, getAffiliateLink };
